OASISFormat: 0.4
Name:        pendulum
Version:     0.01
Synopsis:    pendulum language and library
Authors:     Remy El Siba√Øe
License:     LGPL
Plugins:     META (0.4), DevFiles (0.4)
BuildTools:  ocamlbuild

Flag all
  Description: build and install everything
  Default: false

Flag react
  Description: build and install react related exemples
  Default$: flag(all)

Flag ppx
  Description: Build the ppx syntax extension
  Default$: flag(all)

Library pendulum
  Path: src/runtime/
  Pack: true
  Install: true
  Modules: Runtime_ast, Runtime_misc, Signal, Program

Library compiler
  Path: src/preproc/
  Pack: true
  Install: true
  FindlibParent: pendulum
  FindlibName: compiler 
  Modules: Utils, Ast, Grc, Grc2ml, Ml2ocaml, Gen_names, Gen_utils
  BuildDepends:
    unix,
    ppx_tools.metaquot

Library rml_backend
  Path: src/rml/
  Install: true
  Pack: true
  Modules: Ast2rml
  FindlibName: rml_backend 
  FindlibParent: pendulum
  BuildDepends: pendulum.compiler

Library ppx_pendulum
   Path: src/ppx
   FindlibParent: pendulum
   FindlibName: ppx
   Install: true
   Modules: Ppx_pendulum
   XMETADescription: New-style (ppx) syntax extension
   XMETARequires:    pendulum
   XMETAExtraLines:  ppx = "ppx_pendulum"

Executable ppx_pendulum
  Path:           src/ppx/
  Install: true
  BuildDepends:
    compiler-libs.common,
    ppx_tools.metaquot,
    pendulum.rml_backend,
    pendulum.compiler
  MainIs:         ppx_pendulum_ex.ml
  CompiledObject: best


Executable "test_ppx"
 Path: tests/ppx
 Build$: flag(tests) || flag(ppx)
 Install: false
 CompiledObject: byte
 MainIs: test_ppx.ml
 BuildTools: ppx_pendulum
 BuildDepends: js_of_ocaml.ppx, oUnit, js_of_ocaml, pendulum

Executable "test_ppx_react"
 Path: tests/ppx
 Build$: flag(tests) || flag(ppx) || flag(react)
 Install: false
 CompiledObject: byte
 MainIs: test_ppx_react.ml
 BuildTools: ppx_pendulum
 BuildDepends: js_of_ocaml.ppx, js_of_ocaml, react, oUnit, pendulum
