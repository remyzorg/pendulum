OASISFormat: 0.4
Name:        pendulum
Version:     0.01
Synopsis:    pendulum language and library
Authors:     Remy El Siba√Øe
License:     LGPL
Plugins:     META (0.4), DevFiles (0.4)
BuildTools:  ocamlbuild

Flag all
  Description: build and install everything
  Default: false

Flag ppx
  Description: Build the ppx syntax extension
  Default$: flag(all)


Library "pendulum"
  Path: src/runtime/
  Pack: true
  Modules: Interp, Runtime_ast, Runtime_misc, Machine

Library "preproc"
  Path: src/preproc/
  Pack: true
  FindlibParent: pendulum
  Modules: Utils, Ast, Grc, Sync2ml
  BuildDepends:
    unix,
    ppx_tools.metaquot,


#Executable "main"
#  Path:       src/
#  MainIs:     main.ml
#  CompiledObject: best
#  BuildDepends:
#    pendulum, unix
    
Executable "ppx_pendulum"
  Path:           src/ppx
  BuildDepends:
    compiler-libs.common,
    ppx_tools.metaquot,
    pendulum.preproc
  MainIs:         ppx_pendulum.ml
  CompiledObject: best

Executable "test_ppx"
  Path: tests/ppx
  Build$: flag(tests) || flag(ppx)
  Install: false
  CompiledObject: best
  MainIs: test_ppx.ml
  BuildTools: ppx_pendulum
  BuildDepends: oUnit, pendulum

Executable test_lang_bin
  Build$: flag(tests)
  Path:	   tests/
  MainIs:  test_lang.ml
  CompiledObject: best
  Install: false
  BuildDepends:
    oUnit, pendulum
    
Test "test_pendulum"
  Run$:		flag(tests)
  Command: 	$test_lang_bin
  WorkingDirectory: tests
  
# Test "test_ppx"
#   Run$:		flag(tests)
#   Command: 	$test_ppx
#   WorkingDirectory: tests/ppx